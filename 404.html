
<!DOCTYPE html>
<html lang="en">
<head>
  <title>Page not found</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta property="og:title" content="Page not found" />

  <!-- CSP and EDS scripts -->
  <meta http-equiv="Content-Security-Policy"
    content="script-src 'nonce-aem' 'strict-dynamic' 'unsafe-inline' http: https:; base-uri 'self'; object-src 'none';"
    move-to-http-header="true">
  <script nonce="aem" type="importmap">
    {
      "imports": {
        "@dropins/tools/": "/scripts/__dropins__/tools/",
        "@dropins/storefront-cart/": "/scripts/__dropins__/storefront-cart/",
        "@dropins/storefront-auth/": "/scripts/__dropins__/storefront-auth/",
        "@dropins/storefront-personalization/": "/scripts/__dropins__/storefront-personalization/"
      }
    }
  </script>
  <script nonce="aem">window.isErrorPage = true; window.errorCode = '404';</script>

  <!-- Dynamic metadata -->
  <script nonce="aem" type="module">
    await fetch('/metadata.json')
      .then(res => res.json())
      .then(({ data = [] }) => {
        const currentUrl = window.location.pathname;
        const match = data.find(entry => {
          const { URL, root, placeholders } = entry;
          const pattern = URL.replace("**", "(.*)");
          const regex = new RegExp(`^${pattern}$`);
          return regex.test(currentUrl);
        });
        if (!match) return;
        const { root, placeholders } = match;
        if (root) {
          const rootMeta = document.createElement('meta');
          rootMeta.name = 'root';
          rootMeta.content = root;
          document.head.appendChild(rootMeta);
        }
        if (placeholders) {
          const placeholdersMeta = document.createElement('meta');
          placeholdersMeta.name = 'placeholders';
          placeholdersMeta.content = placeholders;
          document.head.appendChild(placeholdersMeta);
        }
      }).catch(console.error);
  </script>

  <!-- Global scripts -->
  <script nonce="aem" src="/scripts/scripts.js" type="module"></script>

  <!-- Back button logic -->
  <script nonce="aem" type="module">
    window.addEventListener('load', () => {
      if (document.referrer) {
        const { origin, pathname } = new URL(document.referrer);
        if (origin === window.location.origin) {
          const backBtn = document.createElement('a');
          backBtn.classList.add('button', 'error-button-back');
          backBtn.href = pathname;
          backBtn.textContent = 'Go back';
          const btnContainer = document.querySelector('.button-container');
          btnContainer?.append(backBtn);
        }
      }
    });
  </script>

  <!-- RUM -->
  <script nonce="aem" type="module">
    import { sampleRUM } from '/scripts/aem.js';
    sampleRUM('404', { source: document.referrer });
  </script>

  <!-- Styles -->
  <link rel="stylesheet" href="/styles/styles.css">
  <link rel="stylesheet" href="/styles/lazy-styles.css">

  <!-- Scoped Game Boy styles -->
  <style>
    body { margin: 0; background: #e6e6e6; }
    main.gameboy {
      display: flex;
      justify-content: center;
      align-items: flex-start; /* Align from top */
      flex-direction: column;
      min-height: calc(100vh - var(--nav-height, 64px));
      padding: 2rem;
      margin-top: 4rem; /* Extra space below sticky header */
    }
    .gameboy-container { display: flex; flex-direction: column; align-items: center; gap: 1.5rem; width: 100%; }
    .gameboy-screen {
      background: #9ca370; border: 20px solid #8b8b8b; border-radius: 10px;
      padding: 2rem; max-width: 400px; width: 100%; aspect-ratio: 10/9;
      box-shadow: inset 2px 2px 15px rgba(0,0,0,0.3), 5px 5px 15px rgba(0,0,0,0.2);
    }
    .screen-content { display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 1rem; text-align: center; }
    .pixel-text { font-size: 1.2rem; font-weight: bold; }
    .error-text { font-size: 2rem; font-weight: bold; text-shadow: 2px 2px #627142; }
    .game-text { font-size: 1.5rem; }
    .instructions { font-size: 1rem; animation: blink 1s infinite; }
    .controls-container { display: flex; justify-content: space-between; max-width: 400px; width: 100%; }
    .d-pad-container { width: 120px; height: 120px; position: relative; }
    .d-pad button, .d-pad-center { background: #333; border: none; position: absolute; }
    .d-pad-center { width: 40px; height: 40px; left: 50%; top: 50%; transform: translate(-50%, -50%); }
    .gameboy-container .button { width: 50px; height: 50px; border-radius: 50%; background: #a93671; color: #e6e6e6; font-weight: bold; }
    .start-button { padding: 0.6rem 2rem; background: #8b8b8b; color: #fff; text-decoration: none; border-radius: 6px; font-weight: bold; }
    .actions { display: flex; flex-direction: column; align-items: center; gap: 12px; }
    @keyframes blink { 0%,100%{opacity:1;}50%{opacity:0;} }
  </style>
</head>

<body>
  <header></header>
  <main class="gameboy">
    <div class="gameboy-container">
      <section class="gameboy-screen">
        <div class="screen-content">
          <div class="pixel-text">KHALIL MANNS</div>
          <h1 class="error-text">ERROR 404</h1>
          <p class="game-text">GAME OVER<br>PAGE NOT FOUND</p>
          <p class="instructions">PRESS START<br>TO RETURN HOME</p>
        </div>
      </section>

      <div class="controls-container">
        <div class="d-pad-container">
          <div class="d-pad">
            <div class="d-pad-center"></div>
            <button style="top:0;left:50%;transform:translateX(-50%);width:40px;height:40px;"></button>
            <button style="right:0;top:50%;transform:translateY(-50%);width:40px;height:40px;"></button>
            <button style="bottom:0;left:50%;transform:translateX(-50%);width:40px;height:40px;"></button>
            <button style="left:0;top:50%;transform:translateY(-50%);width:40px;height:40px;"></button>
          </div>
        </div>
        <div class="action-buttons">
          <div class="ab-buttons" style="display:flex;gap:1rem;transform:rotate(-25deg);">
            <button class="button">B</button>
            <button class="button">A</button>
          </div>
        </div>
      </div>

      <div class="actions">
        <a href="/" class="start-button">START</a>
        <p class="button-container">
          <a href="/" class="start-button">Go home</a>
        </p>
      </div>
    </div>
  </main>
  <footer></footer>
</body>
</html>
